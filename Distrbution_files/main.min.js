OrchardMap=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=!1,y=!1,z={northAmerica:"region-0",southAmerica:"region-1",europe:"region-2",africa:"region-3",asia:"region-4",australia:"region-5"};getSvg=function(a){var b=new XMLHttpRequest;b.open("GET",svgUrl),b.overrideMimeType("image/svg+xml"),b.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("orchard-map-wrapper").appendChild(b.responseXML.documentElement),"function"==typeof a&&a())},b.send()},init=function(){setElements(),addPathsFromMarkers(),setEventListeners(),u=isMobile()},targetFromWindowHash=function(){var a=window.location.hash.slice(1);switch(a){case"offices":return a;case"digital":return a;case"physical":return a;case"performance":return a}return!1},isMobile=function(){return window.innerWidth<=767},isTouchDevice=function(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}},getById=function(a){return document.getElementById(a)},setElements=function(){p=getById("orchard-map-retailers-modal"),a=getById("orchard-map-svg"),c=getById("marker-info-window"),d=document.querySelectorAll(".orchard-map-toggle-btn"),g=a.createSVGPoint(),r=getById("map-type"),s=getById("map-region"),j=getById("orchard-map-info-window-title"),k=getById("orchard-map-info-window-location"),subtitle=getById("orchard-map-info-window-subtitle"),l=getById("orchard-map-info-window-territories-wrapper"),m=getById("orchard-map-info-window-email"),n=getById("orchard-map-info-window-extra"),q=getById("orchard-map-close-modal"),v=getById("orchard-map-mobile-close-modal"),t=getById("orchard-retailers-modal-trigger"),o=getById("orchard-map-info-window-contact-outer");var b=targetFromWindowHash();setMapType(b),y=/MSIE/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent),y&&(a.setAttribute("preserveAspectRatio","xMinYMin meet"),a.style.maxWidth="100%",ieSvgSizing()),fadeIn(!!b)},setEventListeners=function(){for(a.addEventListener("mousedown",svgMouseDown),q.addEventListener("mousedown",closeModalMouseDown),v.addEventListener("mousedown",closeModalMouseDown),c.addEventListener("mouseleave",hideInfoWindow),t.addEventListener("mousedown",mobileRetailersModalToggle),window.addEventListener("resize",resizeThrottler),e=0;e<d.length;e++)d[e].addEventListener("click",toggleMap);var b=a.querySelectorAll(".region-0, .region-1, .region-2, .region-3, .region-4, .region-5");for(e=0;e<b.length;e++)b[e].addEventListener("mouseenter",countryMouseEnter),b[e].addEventListener("mouseleave",countryMouseLeave)},resizeThrottler=function(){w||(w=setTimeout(function(){w=null,actualResizeHandler()},20))},ieSvgSizing=function(){var b=1470.631/3252.766,c=window.innerWidth+200;a.setAttribute("width",c),a.setAttribute("height",c*b)},actualResizeHandler=function(){if(b&&setInfoAndPlaceWindow(),isMobile()&&"offices"==f&&setMapType("digital",!!targetFromWindowHash()),y&&ieSvgSizing(),u!=isMobile()){u=isMobile(),closeModal();var a=isMobile()?15:7;for(e=0;e<markers.length;e++)"offices"!=markers[e].type&&markers[e].element.setAttribute("r",a)}},svgMouseDown=function(){hideInfoWindow(),isMobile()||"offices"==f||"string"!=typeof h||showModal()},titleForType=function(){return document.querySelector(".orchard-map-toggle-btn.active").textContent},titleForRegion=function(){return regionMap[h]},mobileRetailersModalToggle=function(){showModal()},showModal=function(){p.setAttribute("data-type",f),p.setAttribute("data-region",h);var a=document.querySelectorAll(".map-type");for(e=0;e<a.length;e++){var b="map-type-"+f;a[e].className=a[e].className.replace(/\s*active\s*/,""),a[e].className.indexOf(b)>=0&&(a[e].className=a[e].className+" active")}s.textContent=titleForRegion(),p.style.zIndex=isMobile()?10:1,isMobile()&&(document.documentElement.style.overflow="hidden",document.documentElement.className=document.documentElement.className+" map-modal-open "),x=!0,p.className="showing",trackEvents("Content","Click Distribution Map",titleForRegion())},closeModalMouseDown=function(){closeModal()},closeModal=function(b){x=!1,isMobile(),document.documentElement.style.overflow="",document.documentElement.className=document.documentElement.className.replace(/\s*map-modal-open\s*/," "),p.className="",setTimeout(function(){p.style.zIndex=-1;var c=a.className.baseVal;c=c.replace(/\s*hovering-region-\d\s*/," "),a.setAttribute("class",c),h=null,i=!1,"function"==typeof b&&b()},300)},countryMouseEnter=function(b){if("offices"!=f&&!isMobile()){i=!0;var c=function(){var a,c=b.currentTarget.className.baseVal.split(" ");for(e=0;e<c.length;e++)if(0==c[e].indexOf("region")){a=c[e];break}return a}(b);if("undefined"!=typeof c&&c!=h){if("physical"===f&&(c===z.africa||c===z.asia||c===z.australia)){var d=a.className.baseVal;return d=d.replace(/\s*hovering-region-\d\s*/," "),void a.setAttribute("class",d)}h=c,addSvgClass(c)}}},addSvgClass=function(b){var c=a.className.baseVal;c=c.replace(/\s*hovering-region-\d\s*/," "),a.setAttribute("class",c+" hovering-"+b)},countryMouseLeave=function(b){"offices"!=f&&(x||(i=!1,setTimeout(function(){if(!i){if(b.toElement){if("path"==b.toElement.nodeName)return;if("circle"==b.toElement.nodeName)return}var c=a.className.baseVal;c=c.replace(/hovering-region-\d/,""),a.setAttribute("class",c),h=null,i=!1}},150)))},cursorPoint=function(b){return g.x=b.clientX,g.y=b.clientY,g.matrixTransform(a.getScreenCTM().inverse())},addPathsFromMarkers=function(){for(var a=0;a<officeMarkers.length;a++)officeMarkers[a].id="marker-"+markers.length+"-"+Date.now(),markers.push(officeMarkers[a]);for(var a=0;a<markers.length;a++)svgMarkerFromObject(markers[a])},svgMarkerFromObject=function(b){var c;if("offices"==b.type)c=document.createElementNS("http://www.w3.org/2000/svg","path"),c.addEventListener("mouseenter",revealInfoWindow),c.addEventListener("mousedown",revealInfoWindow);else{var d=isMobile()?15:7;c=document.createElementNS("http://www.w3.org/2000/svg","circle"),c.setAttribute("r",d)}return c.setAttribute("id",b.id),c.setAttribute("class",b["class"]),b.element=c,setInitialElementPosition(b),a.appendChild(c),c},toggleMap=function(a){a.preventDefault(),setMapType(a.currentTarget.dataset.toggle,!0)},setMapType=function(b,c){if(b||(b="digital"),isMobile()&&"offices"==b&&(b="digital"),c&&(window.location.hash=b),f!=b){for(f=b,hideInfoWindow(),f=b,a.setAttribute("class",f),e=0;e<d.length;e++)d[e].className=d[e].dataset.toggle==b?"orchard-map-toggle-btn active":"orchard-map-toggle-btn";var g=a.className.baseVal;g=g.replace(/hovering-region-\d/,""),a.setAttribute("class",g)}},hideInfoWindow=function(){c.style.display="none",b=null,clearInfoWindowData()},revealInfoWindow=function(a){return a.preventDefault(),a.stopPropagation(),isMobile()?void hideInfoWindow(a):(b=a.currentTarget,void setInfoAndPlaceWindow())},setInfoAndPlaceWindow=function(){if(isMobile())return void hideInfoWindow(event);var a=markers[markerIndexById(b.id)];setInfoWindowData(a),c.style.left="10000000px",c.style.display="inline-block",c.style.opacity="1";var d=document.getElementById("orchard-map-wrapper").getBoundingClientRect(),e=b.getBoundingClientRect(),f=c.getBoundingClientRect(),g=e.left+e.width/2,h=f.width/2;20>g-h?g=h+20:g+h>window.innerWidth-20&&(g=window.innerWidth-h-20),c.style.top=e.top-d.top+"px",c.style.left=g+"px"},clearInfoWindowData=function(){j.innerHTML="",k.innerHTML="",subtitle.innerHTML="",m.innerHTML="",n.innerHTML="",l.innerHTML=""},setInfoWindowData=function(a){clearInfoWindowData(),j.innerHTML=a.data.title,k.innerHTML=a.data.location,subtitle.innerHTML=a.data.subtitle,subtitle.style.display=a.data.subtitle?"":"none",m.innerHTML="<a href='mailto:"+a.data.email+"'>"+a.data.email+"</a>",m.style.display=a.data.email?"":"none",n.innerHTML=a.data.extra,n.style.display=a.data.extra?"":"none",o.style.display=a.data.extra||a.data.email?"":"none";var b;for(e=0;e<a.data.territories.length;e++)b=document.createElement("li"),b.innerHTML=a.data.territories[e],l.appendChild(b)},setInitialElementPosition=function(a){if("offices"==a.type){var b=2.5,c=isTouchDevice()?a.position.x/b:a.position.x,d=isTouchDevice()?a.position.y/b-50:a.position.y-50;a.element.setAttribute("d","M"+c+" "+d+"c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z"),isTouchDevice()&&a.element.setAttribute("transform","scale("+b+")")}else a.element.setAttribute("cx",a.position.x),a.element.setAttribute("cy",a.position.y)},setElementPosition=function(a,b,c){if("offices"==selector.value){var b=isTouchDevice()?b/2:b,c=isTouchDevice()?(c-50)/2:c-50;a.setAttribute("d","M"+b+" "+(c-50)+"c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z"),isTouchDevice()&&(a.setAttribute("-webkit-transform","scale(2.0)"),a.setAttribute("-moz-transform","scale(2.0)"),a.setAttribute("-ms-transform","scale(2.0)"),a.setAttribute("-o-transform","scale(2.0)"),a.setAttribute("transform","scale(2.0)"))}else a.setAttribute("cx",b),a.setAttribute("cy",c)},setPosition=function(a,b){"object"==typeof a&&a.setAttribute("d",getSvgPath(b.x,b.y))},markerIndexById=function(a){for(var b=0;b<markers.length;b++)if(markers[b].id==a)return b},getCurrentTarget=function(){return f},fadeIn=function(a){a&&window.scrollTo(0,document.getElementById("orchard-map-nav").offsetTop-document.getElementById("masthead").offsetHeight);for(var b=["orchard-map-nav","orchard-map-wrapper"],c=0;c<b.length;c++){var d=document.getElementById(b[c]);d.style.opacity=1}},jQuery(document).ready(function(){getSvg(init),jQuery(".region-name").click(function(){var a=jQuery(this).parent();jQuery(".region-name").each(function(b,c){a.attr("class")==jQuery(c).parent().attr("class")?a.toggleClass("active"):jQuery(c).parent().removeClass("active")}),a.hasClass("active")&&window.scrollTo(0,a.offset().top-jQuery(this).outerHeight()+3.5)})})}();